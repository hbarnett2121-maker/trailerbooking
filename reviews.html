<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Customer Reviews - Trailer Booking</title>
  <meta name="color-scheme" content="light">
  <style>
    :root{
      --green:#06F713; --ink:#111; --muted:#6b7280; --border:#e5e7eb; --bg:#ffffff;
      --radius:16px; --star-color:#FFD700; --star-empty:#E5E7EB;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#f8fafc;color:var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif}

    .wrap{max-width:980px;margin:0 auto;padding:clamp(12px,3vw,20px); padding-bottom:48px;}
    h1{margin:8px 0 12px;font-size:clamp(22px,5vw,28px)}
    h2{margin:16px 0 12px;font-size:clamp(18px,4vw,22px)}

    .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius);
      box-shadow:0 6px 24px rgba(0,0,0,.06);padding:20px;margin:16px 0}

    .btn{min-height:48px;border:1px solid var(--border);padding:12px 24px;border-radius:12px;
      background:#fff;cursor:pointer;font-size:16px;width:100%;transition:all 0.2s}
    .btn.primary{background:var(--green);font-weight:700;border-color:var(--green)}
    .btn.primary:hover{opacity:0.9;transform:translateY(-1px)}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    .form-group{margin-bottom:20px}
    .form-label{display:block;margin-bottom:8px;font-weight:600;font-size:15px}
    .form-input, .form-textarea{width:100%;padding:12px;border:1px solid var(--border);
      border-radius:10px;font-size:16px;font-family:inherit;transition:border-color 0.2s}
    .form-input:focus, .form-textarea:focus{outline:none;border-color:var(--green)}
    .form-textarea{min-height:120px;resize:vertical}

    /* Star Rating Styles */
    .star-rating{display:flex;gap:8px;font-size:40px;cursor:pointer;margin:12px 0}
    .star{color:var(--star-empty);transition:color 0.2s, transform 0.1s}
    .star.filled{color:var(--star-color)}
    .star:hover{transform:scale(1.1)}

    /* Review Display Styles */
    .review-item{padding:20px;border-bottom:1px solid var(--border);margin-bottom:16px}
    .review-item:last-child{border-bottom:none;margin-bottom:0}
    .review-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;flex-wrap:wrap;gap:8px}
    .review-name{font-weight:700;font-size:17px}
    .review-date{color:var(--muted);font-size:14px}
    .review-stars{display:flex;gap:4px;font-size:20px;margin-bottom:8px}
    .review-text{color:var(--ink);line-height:1.6;font-size:15px}

    .success-msg{background:#d1fae5;border:1px solid #10b981;color:#065f46;
      padding:16px;border-radius:10px;margin:16px 0;text-align:center}
    .error-msg{background:#fee2e2;border:1px solid #ef4444;color:#991b1b;
      padding:16px;border-radius:10px;margin:16px 0;text-align:center}

    .empty-state{text-align:center;padding:40px 20px;color:var(--muted)}
    .empty-state svg{width:64px;height:64px;margin-bottom:16px;opacity:0.3}

    .nav-link{display:inline-block;margin:12px 0;color:var(--green);text-decoration:none;font-weight:600}
    .nav-link:hover{text-decoration:underline}

    .stats{display:flex;gap:20px;margin:16px 0;flex-wrap:wrap}
    .stat{text-align:center}
    .stat-value{font-size:32px;font-weight:700;color:var(--green)}
    .stat-label{font-size:14px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <a href="booking.html" class="nav-link">‚Üê Back to Booking</a>

    <h1>üåü Customer Reviews</h1>

    <!-- Statistics Section -->
    <div class="card">
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="avgRating">0.0</div>
          <div class="stat-label">Average Rating</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="totalReviews">0</div>
          <div class="stat-label">Total Reviews</div>
        </div>
      </div>
    </div>

    <!-- Submit Review Section -->
    <div class="card">
      <h2>Write a Review</h2>
      <form id="reviewForm">
        <div class="form-group">
          <label class="form-label">Your Rating *</label>
          <div class="star-rating" id="starRating">
            <span class="star" data-rating="1">‚òÖ</span>
            <span class="star" data-rating="2">‚òÖ</span>
            <span class="star" data-rating="3">‚òÖ</span>
            <span class="star" data-rating="4">‚òÖ</span>
            <span class="star" data-rating="5">‚òÖ</span>
          </div>
          <input type="hidden" id="ratingValue" name="rating" required>
        </div>

        <div class="form-group">
          <label class="form-label" for="name">Your Name *</label>
          <input type="text" id="name" name="name" class="form-input" placeholder="John Doe" required>
        </div>

        <div class="form-group">
          <label class="form-label" for="reviewText">Your Review *</label>
          <textarea id="reviewText" name="review" class="form-textarea"
                    placeholder="Tell us about your experience with our trailer rental service..." required></textarea>
        </div>

        <button type="submit" class="btn primary" id="submitBtn">Submit Review</button>
      </form>

      <div id="message"></div>
    </div>

    <!-- Reviews Display Section -->
    <div class="card">
      <h2>Recent Reviews</h2>
      <div id="reviewsList">
        <div class="empty-state">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
          </svg>
          <p>No reviews yet. Be the first to share your experience!</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Star Rating Interaction
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.getElementById('ratingValue');
    let selectedRating = 0;

    stars.forEach(star => {
      star.addEventListener('click', function() {
        selectedRating = parseInt(this.dataset.rating);
        ratingInput.value = selectedRating;
        updateStars(selectedRating);
      });

      star.addEventListener('mouseenter', function() {
        const hoverRating = parseInt(this.dataset.rating);
        updateStars(hoverRating);
      });
    });

    document.getElementById('starRating').addEventListener('mouseleave', function() {
      updateStars(selectedRating);
    });

    function updateStars(rating) {
      stars.forEach((star, index) => {
        if (index < rating) {
          star.classList.add('filled');
        } else {
          star.classList.remove('filled');
        }
      });
    }

    // Form Submission
    document.getElementById('reviewForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      if (selectedRating === 0) {
        showMessage('Please select a star rating', 'error');
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      const formData = {
        rating: selectedRating,
        name: document.getElementById('name').value.trim(),
        review: document.getElementById('reviewText').value.trim(),
        timestamp: new Date().toISOString()
      };

      try {
        const response = await fetch('/api/reviews', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok) {
          showMessage('Thank you for your review! It has been submitted successfully.', 'success');
          document.getElementById('reviewForm').reset();
          selectedRating = 0;
          updateStars(0);

          // Reload reviews
          setTimeout(() => {
            loadReviews();
          }, 1000);
        } else {
          showMessage(result.error || 'Failed to submit review. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Error submitting review:', error);
        showMessage('Network error. Please check your connection and try again.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Review';
      }
    });

    // Load Reviews
    async function loadReviews() {
      try {
        const response = await fetch('/api/reviews');
        const data = await response.json();

        if (response.ok && data.reviews) {
          displayReviews(data.reviews);
          updateStats(data.reviews);
        } else {
          console.error('Failed to load reviews');
        }
      } catch (error) {
        console.error('Error loading reviews:', error);
      }
    }

    function displayReviews(reviews) {
      const reviewsList = document.getElementById('reviewsList');

      if (reviews.length === 0) {
        reviewsList.innerHTML = `
          <div class="empty-state">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <p>No reviews yet. Be the first to share your experience!</p>
          </div>
        `;
        return;
      }

      reviewsList.innerHTML = reviews.map(review => `
        <div class="review-item">
          <div class="review-header">
            <div class="review-name">${escapeHtml(review.name)}</div>
            <div class="review-date">${formatDate(review.timestamp)}</div>
          </div>
          <div class="review-stars">
            ${generateStars(review.rating)}
          </div>
          <div class="review-text">${escapeHtml(review.review)}</div>
        </div>
      `).join('');
    }

    function updateStats(reviews) {
      const totalReviews = reviews.length;
      document.getElementById('totalReviews').textContent = totalReviews;

      if (totalReviews > 0) {
        const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / totalReviews;
        document.getElementById('avgRating').textContent = avgRating.toFixed(1);
      } else {
        document.getElementById('avgRating').textContent = '0.0';
      }
    }

    function generateStars(rating) {
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
          stars += '<span style="color:var(--star-color)">‚òÖ</span>';
        } else {
          stars += '<span style="color:var(--star-empty)">‚òÖ</span>';
        }
      }
      return stars;
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.className = type === 'success' ? 'success-msg' : 'error-msg';
      messageDiv.textContent = text;
      messageDiv.style.display = 'block';

      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    }

    // Load reviews on page load
    loadReviews();
  </script>
</body>
</html>
